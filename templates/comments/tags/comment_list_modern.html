{% load blog_tags %}
{% load comments_tags %}
{% load cache %}

<!-- 现代化评论系统 - Alpine.js驱动 -->
<div x-data="commentSystem()"
     x-init="init()"
     data-article-id="{{ article.id }}"
     class="comments-area modern-comments">

    <section id="comments" class="py-8">
        <!-- 评论标签头部 -->
        <div class="comment-tabs mb-6">
            <div class="flex items-center space-x-2 text-lg font-semibold text-gray-900 dark:text-gray-100">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                </svg>
                <span>评论</span>
                <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900 text-primary-600 dark:text-primary-300 rounded text-sm">
                    {{ comment_count }}
                </span>
            </div>
        </div>

        {% if article_comments %}
            <!-- 评论列表 -->
            <div id="commentlist-container" class="space-y-4">
                <ol class="commentlist space-y-6">
                    {% for comment_item in p_comments %}
                        {% with 0 as depth %}
                            {% include "comments/tags/comment_item_modern.html" %}
                        {% endwith %}
                    {% endfor %}
                </ol>

                <!-- 分页导航 - HTMX boost 自动处理 -->
                {% if comment_prev_page_url or comment_next_page_url %}
                <nav class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    {% if comment_prev_page_url %}
                        <a href="{{ comment_prev_page_url }}"
                           class="btn btn-secondary inline-flex items-center space-x-2"
                           rel="prev">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                            <span>上一页</span>
                        </a>
                    {% else %}
                        <div></div>
                    {% endif %}

                    {% if comment_next_page_url %}
                        <a href="{{ comment_next_page_url }}"
                           class="btn btn-secondary inline-flex items-center space-x-2"
                           rel="next">
                            <span>下一页</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>
                    {% else %}
                        <div></div>
                    {% endif %}
                </nav>
                {% endif %}
            </div>
        {% else %}
            <!-- 无评论提示 -->
            <div class="text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-lg">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                </svg>
                <p class="text-gray-500 dark:text-gray-400 text-lg">
                    暂无评论，快来抢沙发吧！
                </p>
            </div>
        {% endif %}

        <!-- 错误提示 -->
        <div x-show="error"
             x-transition
             class="mt-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-100 rounded-lg flex items-start space-x-3">
            <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
            </svg>
            <span x-text="error"></span>
        </div>
    </section>
</div>
